{% extends "@App/baseView.html.twig" %}
{% block title %}{{ model.stock.product.name }}{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href={{ asset('css/detailsView.css') }}>
{% endblock %}

{% block content %}
    <div class="wrapper">
        <div class="preview col-md-6">

            <div class="preview-pic tab-content">
                {% set num = 1 %}
                {% for picture in model.product.images %}
                    <div class="tab-pane {{ num == 1? "active" }}" id="pic-{{ num }}"><img src="{{ picture.url }}"/>
                    </div>
                    {% set num = num+1 %}

                {% endfor %}
            </div>
            <ul class="preview-thumbnail nav nav-tabs">
                {% set num = 1 %}
                {% for picture in model.product.images %}

                    <li class={{ num == 1 ? "active" }}><a data-target="#pic-{{ num }}" data-toggle="tab"><img
                                    src={{ picture.url }}/></a></li>
                    {% set num = num + 1 %}

                {% endfor %}
            </ul>

        </div>
        <div class="details col-md-6">
            <h3 class="product-title">{{ model.product.name }}</h3>
            <p class="product-description">{{ model.product.description }}</p><br>

            {% if model.stockActivePromotion %}
                <h4 class="price">current price:<br><span
                            style="color:red">BGN:{{ model.stockFinalPrice|number_format(2) }}</span></h4><br>
                <h4 class="price">old price:<br><span
                            style="text-decoration: line-through; text-decoration-color: white">BGN:{{ model.product.price|number_format(2) }}</span>
                </h4><br>
            {% else %}
                <h4 class="price">current price:<br><span>BGN:{{ model.stockFinalPrice|number_format(2) }}</span></h4>
                <br>
            {% endif %}
            <h5 class="price">Quantity : {{ model.stock.quantity }} </h5>

            <h5 class="colors">In Stock:
                {% set prev = "" %}
                {% for currStock in model.stocksToShow|sort %}
                    {% if currStock["stock"].size.name!= prev %}
                        <span class="size">{{ currStock["stock"].size.name }}:</span>
                    {% endif %}
                    <a title={{ currStock['stock'].color.name }} href={{ currStock["stock"].id }}><span
                                class="color {{ model.stock.id==currStock["stock"].id ? 'active' }}"
                                style="background-color: {{ currStock["stock"].color.name|lower=="black"?"#333333": currStock["stock"].color.name }}"
                                data-toggle="tooltip" data-original-title>
                            {% if currStock['activePromotion'] %}
                                <h6 style="color:#521135; font-weight: 700">-{{ currStock["activePromotion"].percentage }}%
                                   </h6>
                            {% endif %}

                            </span></a>
                    {% set prev = currStock["stock"].size.name %}
                {% endfor %}


            </h5>
            <div class="action">
                {% if is_granted("ROLE_ADMIN") %}
                    <h2>You are Admin, nothing to do here!</h2>
                {% elseif is_granted("ROLE_USER") %}
                    <a href="{{ path('orderProduct',{"id":model.stock.id}) }}" class="add-to-cart btn btn-default"
                       type="button">add to cart</a>
                {% elseif is_granted("IS_AUTHENTICATED_ANONYMOUSLY") %}
                    <a href="{{ path("fos_user_security_login") }}" class="add-to-cart btn btn-default" type="button">Login
                        To Buy</a>
                {% endif %}
            </div>
        </div>
    </div>

{% endblock %}